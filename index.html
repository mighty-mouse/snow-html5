<!DOCTYPE html>
<html>
	<head>
		<title>Snow Day</title>
		<meta charset="utf-8">
		<link href="style.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

		
	</head>
	<body onload="init(300, 1200, 734)">
		<!--<script type="text/javascript" src="js/ThreeCanvas.js"></script>-->
		<script type="text/javascript" src="js/dat.gui.js"></script>
		
		<script type="text/javascript" src="js/three.js"></script>
		<script type="text/javascript" src="js/Snow.js"></script>
		<script>


		
/////////////////
			var snowAmount = 500;

			var looper = null;

			var SCREEN_WIDTH = window.innerWidth;
			var SCREEN_HEIGHT = window.innerHeight;

			var container;

			var particle;

			var camera;
			var scene;
			var renderer;

			var mouseX = 0;
			var mouseY = 0;

			var context;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			
			var particles = []; 
			var particleImage = new Image();//THREE.ImageUtils.loadTexture( "img/ParticleSmoke.png" );
			particleImage.src = 'img/ParticleSmoke.png'; 

			function init(particleAmount, canvasW, canvasH) {


				
				snowAmount=particleAmount;

				container = document.getElementById('canvasContainer');
				

				camera = new THREE.PerspectiveCamera( 75, canvasW / canvasH, 1, 10000 );
				camera.position.z = 1000;

				scene = new THREE.Scene();
				scene.add(camera);
					
				renderer = new THREE.CanvasRenderer();
				renderer.setSize(canvasW, canvasH);
				var material = new THREE.ParticleBasicMaterial( { map: new THREE.Texture(particleImage) } );

///////////////////// image plane method
				/*var img = new THREE.MeshBasicMaterial({ //CHANGED to MeshBasicMaterial
			        map:THREE.ImageUtils.loadTexture('img/bg.png')
			    });
			    img.map.needsUpdate = true; //ADDED

			    // plane
			    var plane = new THREE.Mesh(new THREE.PlaneGeometry(1209, 734),img);
			    plane.overdraw = true;
			    
			    plane.position.x = 0;
			    plane.position.y = 0;
			    plane.position.z = 500;
			    plane.doubleSided = true;
			    scene.add(plane);

			    // add subtle ambient lighting
			    var ambientLight = new THREE.AmbientLight(0x555555);
			    scene.add(ambientLight);

			    // add directional light source
			    var directionalLight = new THREE.DirectionalLight(0xffffff);
			    directionalLight.position.set(1, 1, 1).normalize();
			    scene.add(directionalLight);*/

///////////////////// img tag method
				//context = document.getElementsByTagName("canvas")[0].getContext("2d");

				particles = []; 
				for (var i = 0; i < particleAmount; i++) {

					particle = new Particle3D( material);
					particle.position.x = Math.random() * 2000 - 1000;
					particle.position.y = Math.random() * 2000 - 1000;
					particle.position.z = Math.random() * 8000 + 500;
					particle.scale.x = particle.scale.y =  1;
					scene.add( particle );
					
					particles.push(particle); 
				}

				container.appendChild( renderer.domElement );

	
				looper = setInterval( loop, 1000 / 60 );
				
			}

			function kill() {
				clearInterval(looper);
				container.removeChild(document.getElementsByTagName("canvas")[0]);
			}

			function addSnow(){
				snowAmount = snowAmount + 50;
				kill();
				init(snowAmount, 1200, 734);
				renderer.render(scene, camera);
			}

			function reduceSnow(){
				snowAmount = snowAmount - 50;
				kill();
				init(snowAmount, 1200, 734);
				renderer.render(scene, camera);
			}

			function loop() {
				for(var i = 0; i<particles.length; i++)
				{
					var particle = particles[i]; 
					particle.updatePhysics(); 
	
					with(particle.position)
					{
						if(y<-1000) y+=2000; 
						if(x>1000) x-=2000; 
						else if(x<-1000) x+=2000; 
						if(z>1000) z-=2000; 
						else if(z<-1000) z+=2000; 
					}				
				}
			
				camera.position.x += ( mouseX - camera.position.x ) * 0.05;
				camera.position.y += ( - mouseY - camera.position.y ) * 0.05;
				camera.lookAt(scene.position); 

				renderer.render( scene, camera );				
			}
		</script>

		<!--<canvas id="myCanvas" width="500" height="500"></canvas>-->
		<!-- Insert fallback content here -->
		<button type="button" id="plus" value="add" onclick="addSnow();">+</button>
		<button type="button" id="minus" value="subtract" onclick="reduceSnow();">-</button>
		<div id="main">
			<div id="canvasContainer"></div>
			<img src="img/bg.png" id="streetView" /></img>
		</div>
	</body>
</html>