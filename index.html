<!DOCTYPE html>
<html>
	<head>
		<title>Snow Day</title>
		<meta charset="utf-8">
		<link href="style.css" rel="stylesheet" type="text/css">
	</head>
	<body onload="canvasSnow.init(700, 1200, 734)">
		<script type="text/javascript" src="js/three.js"></script>
		<script type="text/javascript" src="js/Snow.js"></script>
		<script>
var canvasSnow = (function() {
	var snowAmount = 500;

	var looper = null;

	var SCREEN_WIDTH = window.innerWidth;
	var SCREEN_HEIGHT = window.innerHeight;
	var canvasHeight = null;
	var canvasWidth = null;

	var container;

	var particle;

	var camera;
	var scene;
	var renderer;
 
 	var particles = []; 
	var particleImage = new Image();//THREE.ImageUtils.loadTexture( "img/ParticleSmoke.png" );
	particleImage.src = 'img/ParticleSmoke.png'; 

	function init(particleAmount, canvasW, canvasH) {
		canvasWidth = canvasW;
		canvasHeight = canvasH;

		snowAmount=particleAmount;

		container = document.getElementById('canvasContainer');
		
		camera = new THREE.PerspectiveCamera( 75, canvasWidth / canvasHeight, 1, 10000 );
		camera.position.z = 1000;

		scene = new THREE.Scene();
		scene.add(camera);
			
		renderer = new THREE.CanvasRenderer();
		renderer.setSize(canvasWidth, canvasHeight);
		var material = new THREE.ParticleBasicMaterial( { map: new THREE.Texture(particleImage) } );

		particles = []; 
		for (var i = 0; i < particleAmount; i++) {

			particle = new Particle3D( material);
			particle.position.x = Math.random() * 2000 - 1000;
			particle.position.y = Math.random() * 2000 - 1000;
			particle.position.z = Math.random() * 8000 + 500;
			particle.scale.x = particle.scale.y =  1;
			scene.add( particle );
			
			particles.push(particle); 
		}

		container.appendChild( renderer.domElement );


		looper = setInterval( loop, 1000 / 60 );
		
	}

	function kill() {
		try{
			clearInterval(looper);
			container.removeChild(document.getElementsByTagName("canvas")[0]);
		}
		catch (e) {

		}
	}

	function setSnow(amount) {
		amount = amount-1;
		var snowAmount = [100, 300, 500];
		kill();
		init(snowAmount[amount], canvasWidth, canvasHeight);
		renderer.render(scene, camera);
	}

	function loop() {
		for(var i = 0; i<particles.length; i++)
		{
			var particle = particles[i]; 
			particle.updatePhysics(); 

			with(particle.position)
			{
				if(y<-1000) y+=2000; 
				if(x>1000) x-=2000; 
				else if(x<-1000) x+=2000; 
				if(z>1000) z-=2000; 
				else if(z<-1000) z+=2000; 
			}				
		}


		renderer.render( scene, camera );				
	}

	return {
		init: function(particleAmount, canvasW, canvasH) {
			kill();
			init(particleAmount, canvasW, canvasH);
		},
		setSnow: function(amount) {
			setSnow(amount);
		}
	};
})();
		</script>
		<div id="main">
			<div id="canvasContainer"></div>
			<input type="image" src="img/plus.png" name="plus" width="200" height="75" onclick="canvasSnow.setSnow(1)">
			<input type="image" src="img/plus.png" name="plus" width="200" height="75" onclick="canvasSnow.setSnow(2)">
			<input type="image" src="img/minus.png" name="plus" width="200" height="75" onclick="canvasSnow.setSnow(3)">
			<img src="img/bg.png" id="streetView" /></img>
		</div>
	</body>
</html>